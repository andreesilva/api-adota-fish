"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const Cliente_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Cliente"));
const CreateDoacaoPetValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/CreateDoacaoPetValidator"));
const Pet_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Pet"));
const DoacaoPet_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/DoacaoPet"));
const EditCreatePhotoClienteValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/EditCreatePhotoClienteValidator"));
class DoacaoPetController {
    async store({ auth, response, request }) {
        const payload = await request.validate(CreateDoacaoPetValidator_1.default);
        const userAuth = await auth.use("api").authenticate();
        const cliente = await Cliente_1.default.findByOrFail("user_id", userAuth.id);
        const trx = await Database_1.default.transaction();
        try {
            const pet = await Pet_1.default.create({
                foto: payload.foto,
                especie_id: payload.especie_id,
                quantidade: payload.quantidade,
                observacao: payload.observacao
            });
            const doacao = await DoacaoPet_1.default.create({
                cliente_id_doador: cliente.id,
                pet_id: pet.id,
                status: 1
            });
            await trx.commit();
            return response.ok({
                id: doacao.id,
                cliente_id_doador: doacao.cliente_id_doador,
                status: doacao.status
            });
        }
        catch (error) {
            await trx.rollback();
            return response.badRequest("Something in the request is wrong" + error);
        }
    }
    async all({ response, params }) {
        const id = params.id;
        if (id == 0) {
            const doacoes = await DoacaoPet_1.default.query()
                .where("status", 1)
                .preload("cliente_doador", (addressQuery) => {
                addressQuery
                    .preload("usuario")
                    .preload("endereco", (cityQuery) => {
                    cityQuery
                        .preload("cidade", (stateQuery) => {
                        stateQuery
                            .preload("estado");
                    });
                });
            })
                .preload("pet", (petsQuery) => {
                petsQuery
                    .preload("especie");
            })
                .orderBy("created_at", "desc");
            return response.ok(doacoes);
        }
        else {
            const existRegister = await Database_1.default.rawQuery(`select doacao_pets.id, pets.foto, cidades.nome,estados.nome ,especies.nome
                from doacao_pets
                inner join pets on doacao_pets.pet_id = pets.id 
                inner join especies on pets.especie_id = especies.id 
                inner join clientes on doacao_pets.cliente_id_doador = clientes.id 
                inner join users on clientes.user_id = users.id 
                inner join enderecos on clientes.id = enderecos.cliente_id 
                inner join cidades on enderecos.cidade_id = cidades.id 
                inner join estados on cidades.estado_id = estados.id 
                where doacao_pets.status = :status and estados.id = :estado`, {
                status: 1,
                estado: id
            });
            const doacoes = await DoacaoPet_1.default.query()
                .where("status", 1)
                .preload("cliente_doador", (addressQuery) => {
                addressQuery
                    .preload("usuario")
                    .preload("endereco", (cityQuery) => {
                    cityQuery
                        .preload("cidade", (stateQuery) => {
                        stateQuery
                            .preload("estado", (stateIdQuery) => {
                            stateIdQuery.where('id', id);
                        });
                    });
                });
            })
                .preload("pet", (petsQuery) => {
                petsQuery
                    .preload("especie");
            })
                .orderBy("created_at", "desc");
            if (existRegister[0] == "") {
                return response.ok([]);
            }
            else {
                return response.ok(doacoes);
            }
        }
    }
    async index({ auth, response }) {
        const userAuth = await auth.use("api").authenticate();
        const cliente = await Cliente_1.default.findByOrFail("user_id", userAuth.id);
        const doacoes = await DoacaoPet_1.default.query()
            .where("cliente_id_doador", cliente.id)
            .where("status", 1)
            .orWhere("status", 2)
            .preload("cliente_doador", (addressQuery) => {
            addressQuery
                .preload("usuario")
                .preload("endereco", (cityQuery) => {
                cityQuery
                    .preload("cidade", (stateQuery) => {
                    stateQuery
                        .preload("estado");
                });
            });
        })
            .preload("pet", (petsQuery) => {
            petsQuery
                .preload("especie");
        })
            .orderBy("created_at", "desc");
        return response.ok(doacoes);
    }
    async show({ params, response }) {
        const idDoacao = params.id;
        const pedido = await DoacaoPet_1.default.query()
            .where("id", idDoacao)
            .preload("cliente_doador", (addressQuery) => {
            addressQuery
                .preload("usuario")
                .preload("endereco", (cityQuery) => {
                cityQuery
                    .preload("cidade", (stateQuery) => {
                    stateQuery
                        .preload("estado");
                });
            });
        })
            .preload("pet", (petsQuery) => {
            petsQuery
                .preload("especie");
        })
            .orderBy("id", "desc")
            .first();
        if (pedido == null) {
            return response.notFound("NÃ£o encontrado");
        }
        return response.ok(pedido);
    }
    async inactivate({ response, params }) {
        const id = params.id;
        try {
            const doacao = await DoacaoPet_1.default.findByOrFail("id", id);
            doacao.merge({
                status: 2
            });
            await doacao.save();
            return response.ok(true);
        }
        catch (error) {
            return response.badRequest("Something in the request is wrong");
        }
    }
    async activate({ response, params }) {
        const id = params.id;
        try {
            const doacao = await DoacaoPet_1.default.findByOrFail("id", id);
            doacao.merge({
                status: 1
            });
            await doacao.save();
            return response.ok(true);
        }
        catch (error) {
            return response.badRequest("Something in the request is wrong");
        }
    }
    async delete({ response, params }) {
        const id = params.id;
        try {
            const doacao = await DoacaoPet_1.default.findByOrFail("id", id);
            doacao.merge({
                status: 3
            });
            await doacao.save();
            return response.ok(true);
        }
        catch (error) {
            return response.badRequest("Something in the request is wrong");
        }
    }
    async updatePhoto({ request, response, params }) {
        const payload = await request.validate(EditCreatePhotoClienteValidator_1.default);
        const id = params.id;
        try {
            const pet = await Pet_1.default.findByOrFail("id", id);
            pet.merge({
                foto: payload.foto
            });
            await pet.save();
            return response.ok({
                id: pet.id,
                foto: pet.foto
            });
        }
        catch (error) {
            return response.badRequest("Something in the request is wrong");
        }
    }
}
exports.default = DoacaoPetController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9hY2FvUGV0Q29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRvYWNhb1BldENvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSwyRkFBa0Q7QUFDbEQsdUZBQXlDO0FBQ3pDLDZIQUE4RTtBQUM5RSwrRUFBaUM7QUFDakMsMkZBQTZDO0FBQzdDLDJJQUE2RjtBQUU3RixNQUFxQixtQkFBbUI7SUFFN0IsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUF1QjtRQUUvRCxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLENBQUMsa0NBQXdCLENBQUMsQ0FBQztRQUVqRSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEQsTUFBTSxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRW5FLE1BQU0sR0FBRyxHQUFHLE1BQU0sa0JBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUV6QyxJQUFHO1lBQ0ssTUFBTSxHQUFHLEdBQUcsTUFBTSxhQUFHLENBQUMsTUFBTSxDQUFDO2dCQUN6QixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUk7Z0JBQ2xCLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtnQkFDOUIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO2dCQUM5QixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7YUFDakMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLEdBQUcsTUFBTSxtQkFBUyxDQUFDLE1BQU0sQ0FBQztnQkFDdEMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sRUFBQyxHQUFHLENBQUMsRUFBRTtnQkFDYixNQUFNLEVBQUUsQ0FBQzthQUNSLENBQUMs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fSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IERhdGFiYXNlIGZyb20gJ0Bpb2M6QWRvbmlzL0x1Y2lkL0RhdGFiYXNlJztcbmltcG9ydCBDbGllbnRlIGZyb20gJ0FwcC9Nb2RlbHMvQ2xpZW50ZSc7XG5pbXBvcnQgQ3JlYXRlQWRvY2FvUGV0VmFsaWRhdG9yIGZyb20gJ0FwcC9WYWxpZGF0b3JzL0NyZWF0ZURvYWNhb1BldFZhbGlkYXRvcidcbmltcG9ydCBQZXQgZnJvbSAnQXBwL01vZGVscy9QZXQnO1xuaW1wb3J0IERvYWNhb1BldCBmcm9tICdBcHAvTW9kZWxzL0RvYWNhb1BldCc7XG5pbXBvcnQgRWRpdENyZWF0ZVBob3RvQ2xpZW50ZVZhbGlkYXRvciBmcm9tICdBcHAvVmFsaWRhdG9ycy9FZGl0Q3JlYXRlUGhvdG9DbGllbnRlVmFsaWRhdG9yJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRG9hY2FvUGV0Q29udHJvbGxlciB7XG4gICAgXG4gICAgcHVibGljIGFzeW5jIHN0b3JlKHsgYXV0aCwgcmVzcG9uc2UsIHJlcXVlc3QgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCByZXF1ZXN0LnZhbGlkYXRlKENyZWF0ZUFkb2Nhb1BldFZhbGlkYXRvcik7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1c2VyQXV0aCA9IGF3YWl0IGF1dGgudXNlKFwiYXBpXCIpLmF1dGhlbnRpY2F0ZSgpO1xuICAgICAgICBjb25zdCBjbGllbnRlID0gYXdhaXQgQ2xpZW50ZS5maW5kQnlPckZhaWwoXCJ1c2VyX2lkXCIsIHVzZXJBdXRoLmlkKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgY29uc3QgdHJ4ID0gYXdhaXQgRGF0YWJhc2UudHJhbnNhY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICBjb25zdCBwZXQgPSBhd2FpdCBQZXQuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZm90bzogcGF5bG9hZC5mb3RvLFxuICAgICAgICAgICAgICAgICAgICBlc3BlY2llX2lkOiBwYXlsb2FkLmVzcGVjaWVfaWQsXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aWRhZGU6IHBheWxvYWQucXVhbnRpZGFkZSxcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2YWNhbzogcGF5bG9hZC5vYnNlcnZhY2FvXG4gICAgICAgICAgICAgICAgfSk7ICBcblxuICAgICAgICAgICAgICAgIGNvbnN0IGRvYWNhbyA9IGF3YWl0IERvYWNhb1BldC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGNsaWVudGVfaWRfZG9hZG9yOiBjbGllbnRlLmlkLFxuICAgICAgICAgICAgICAgIHBldF9pZDpwZXQuaWQsIFxuICAgICAgICAgICAgICAgIHN0YXR1czogMVxuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIGF3YWl0IHRyeC5jb21taXQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2soe1xuICAgICAgICAgICAgICAgICAgICBpZDogZG9hY2FvLmlkLFxuICAgICAgICAgICAgICAgICAgICBjbGllbnRlX2lkX2RvYWRvcjogZG9hY2FvLmNsaWVudGVfaWRfZG9hZG9yLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGRvYWNhby5zdGF0dXNcbiAgICAgICAgICAgICAgICB9KTsgICBcbiAgICAgICAgfVxuICAgICAgICBjYXRjaChlcnJvcil7XG4gICAgICAgICAgICBhd2FpdCB0cngucm9sbGJhY2soKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KFwiU29tZXRoaW5nIGluIHRoZSByZXF1ZXN0IGlzIHdyb25nXCIgKyBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGFzeW5jIGFsbCh7IHJlc3BvbnNlLCBwYXJhbXMgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuXG4gICAgICAgIGNvbnN0IGlkID0gcGFyYW1zLmlkO1xuXG4gICAgICAgIGlmKGlkID09IDApe1xuICAgICAgICAgICAgY29uc3QgZG9hY29lcyA9IGF3YWl0IERvYWNhb1BldC5xdWVyeSgpXG4gICAgICAgICAgICAud2hlcmUoXCJzdGF0dXNcIiwgMSlcbiAgICAgICAgICAgIC5wcmVsb2FkKFwiY2xpZW50ZV9kb2Fkb3JcIiwoYWRkcmVzc1F1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgYWRkcmVzc1F1ZXJ5XG4gICAgICAgICAgICAgICAgLnByZWxvYWQoXCJ1c3VhcmlvXCIpXG4gICAgICAgICAgICAgICAgLnByZWxvYWQoXCJlbmRlcmVjb1wiLChjaXR5UXVlcnkpPT57XG4gICAgICAgICAgICAgICAgICAgIGNpdHlRdWVyeVxuICAgICAgICAgICAgICAgICAgICAucHJlbG9hZChcImNpZGFkZVwiLChzdGF0ZVF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVF1ZXJ5XG4gICAgICAgICAgICAgICAgICAgICAgICAucHJlbG9hZChcImVzdGFkb1wiKVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnByZWxvYWQoXCJwZXRcIiwgKHBldHNRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHBldHNRdWVyeVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwiZXNwZWNpZVwiKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcmRlckJ5KFwiY3JlYXRlZF9hdFwiLCBcImRlc2NcIik7XG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKGRvYWNvZXMpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0UmVnaXN0ZXIgPSBhd2FpdCBEYXRhYmFzZS5yYXdRdWVyeShcbiAgICAgICAgICAgICAgICBgc2VsZWN0IGRvYWNhb19wZXRzLmlkLCBwZXRzLmZvdG8sIGNpZGFkZXMubm9tZSxlc3RhZG9zLm5vbWUgLGVzcGVjaWVzLm5vbWVcbiAgICAgICAgICAgICAgICBmcm9tIGRvYWNhb19wZXRzXG4gICAgICAgICAgICAgICAgaW5uZXIgam9pbiBwZXRzIG9uIGRvYWNhb19wZXRzLnBldF9pZCA9IHBldHMuaWQgXG4gICAgICAgICAgICAgICAgaW5uZXIgam9pbiBlc3BlY2llcyBvbiBwZXRzLmVzcGVjaWVfaWQgPSBlc3BlY2llcy5pZCBcbiAgICAgICAgICAgICAgICBpbm5lciBqb2luIGNsaWVudGVzIG9uIGRvYWNhb19wZXRzLmNsaWVudGVfaWRfZG9hZG9yID0gY2xpZW50ZXMuaWQgXG4gICAgICAgICAgICAgICAgaW5uZXIgam9pbiB1c2VycyBvbiBjbGllbnRlcy51c2VyX2lkID0gdXNlcnMuaWQgXG4gICAgICAgICAgICAgICAgaW5uZXIgam9pbiBlbmRlcmVjb3Mgb24gY2xpZW50ZXMuaWQgPSBlbmRlcmVjb3MuY2xpZW50ZV9pZCBcbiAgICAgICAgICAgICAgICBpbm5lciBqb2luIGNpZGFkZXMgb24gZW5kZXJlY29zLmNpZGFkZV9pZCA9IGNpZGFkZXMuaWQgXG4gICAgICAgICAgICAgICAgaW5uZXIgam9pbiBlc3RhZG9zIG9uIGNpZGFkZXMuZXN0YWRvX2lkID0gZXN0YWRvcy5pZCBcbiAgICAgICAgICAgICAgICB3aGVyZSBkb2FjYW9fcGV0cy5zdGF0dXMgPSA6c3RhdHVzIGFuZCBlc3RhZG9zLmlkID0gOmVzdGFkb2AsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgc3RhdHVzOiAxLFxuICAgICAgICAgICAgICAgICAgZXN0YWRvOmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgIGNvbnN0IGRvYWNvZXMgPSBhd2FpdCBEb2FjYW9QZXQucXVlcnkoKVxuICAgICAgICAgICAgLndoZXJlKFwic3RhdHVzXCIsIDEpXG4gICAgICAgICAgICAucHJlbG9hZChcImNsaWVudGVfZG9hZG9yXCIsKGFkZHJlc3NRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIGFkZHJlc3NRdWVyeVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwidXN1YXJpb1wiKVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwiZW5kZXJlY29cIiwoY2l0eVF1ZXJ5KT0+e1xuICAgICAgICAgICAgICAgICAgICBjaXR5UXVlcnlcbiAgICAgICAgICAgICAgICAgICAgLnByZWxvYWQoXCJjaWRhZGVcIiwoc3RhdGVRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVRdWVyeVxuICAgICAgICAgICAgICAgICAgICAgICAgLnByZWxvYWQoXCJlc3RhZG9cIiwoc3RhdGVJZFF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVJZFF1ZXJ5LndoZXJlKCdpZCcsIGlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnByZWxvYWQoXCJwZXRcIiwgKHBldHNRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHBldHNRdWVyeVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwiZXNwZWNpZVwiKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcmRlckJ5KFwiY3JlYXRlZF9hdFwiLCBcImRlc2NcIik7XG5cbiAgICAgICAgICAgIGlmKGV4aXN0UmVnaXN0ZXJbMF0gPT0gXCJcIil7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKFtdKTtcbiAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKGRvYWNvZXMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICBcbiAgICBwdWJsaWMgYXN5bmMgaW5kZXgoeyBhdXRoLCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgICAgIGNvbnN0IHVzZXJBdXRoID0gYXdhaXQgYXV0aC51c2UoXCJhcGlcIikuYXV0aGVudGljYXRlKCk7XG4gICAgICAgIGNvbnN0IGNsaWVudGUgPSBhd2FpdCBDbGllbnRlLmZpbmRCeU9yRmFpbChcInVzZXJfaWRcIiwgdXNlckF1dGguaWQpO1xuXG4gICAgICAgIGNvbnN0IGRvYWNvZXMgPSBhd2FpdCBEb2FjYW9QZXQucXVlcnkoKVxuICAgICAgICAgICAgLndoZXJlKFwiY2xpZW50ZV9pZF9kb2Fkb3JcIiwgY2xpZW50ZS5pZClcbiAgICAgICAgICAgIC53aGVyZShcInN0YXR1c1wiLCAxKVxuICAgICAgICAgICAgLm9yV2hlcmUoXCJzdGF0dXNcIiwgMilcbiAgICAgICAgICAgIC5wcmVsb2FkKFwiY2xpZW50ZV9kb2Fkb3JcIiwoYWRkcmVzc1F1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgYWRkcmVzc1F1ZXJ5XG4gICAgICAgICAgICAgICAgLnByZWxvYWQoXCJ1c3VhcmlvXCIpXG4gICAgICAgICAgICAgICAgLnByZWxvYWQoXCJlbmRlcmVjb1wiLChjaXR5UXVlcnkpPT57XG4gICAgICAgICAgICAgICAgICAgIGNpdHlRdWVyeVxuICAgICAgICAgICAgICAgICAgICAucHJlbG9hZChcImNpZGFkZVwiLChzdGF0ZVF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVF1ZXJ5XG4gICAgICAgICAgICAgICAgICAgICAgICAucHJlbG9hZChcImVzdGFkb1wiKVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnByZWxvYWQoXCJwZXRcIiwgKHBldHNRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHBldHNRdWVyeVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwiZXNwZWNpZVwiKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcmRlckJ5KFwiY3JlYXRlZF9hdFwiLCBcImRlc2NcIik7XG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKGRvYWNvZXMpO1xuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgc2hvdyh7IHBhcmFtcywgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgICAgICBjb25zdCBpZERvYWNhbyA9IHBhcmFtcy5pZDtcblxuICAgICAgICBjb25zdCBwZWRpZG8gPSBhd2FpdCBEb2FjYW9QZXQucXVlcnkoKVxuICAgICAgICAgICAgLndoZXJlKFwiaWRcIiwgaWREb2FjYW8pXG4gICAgICAgICAgICAucHJlbG9hZChcImNsaWVudGVfZG9hZG9yXCIsKGFkZHJlc3NRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgIGFkZHJlc3NRdWVyeVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwidXN1YXJpb1wiKVxuICAgICAgICAgICAgICAgIC5wcmVsb2FkKFwiZW5kZXJlY29cIiwoY2l0eVF1ZXJ5KT0+e1xuICAgICAgICAgICAgICAgICAgICBjaXR5UXVlcnlcbiAgICAgICAgICAgICAgICAgICAgLnByZWxvYWQoXCJjaWRhZGVcIiwoc3RhdGVRdWVyeSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVRdWVyeVxuICAgICAgICAgICAgICAgICAgICAgICAgLnByZWxvYWQoXCJlc3RhZG9cIilcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5wcmVsb2FkKFwicGV0XCIsIChwZXRzUXVlcnkpID0+IHtcbiAgICAgICAgICAgICAgICBwZXRzUXVlcnlcbiAgICAgICAgICAgICAgICAucHJlbG9hZChcImVzcGVjaWVcIilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub3JkZXJCeShcImlkXCIsIFwiZGVzY1wiKVxuICAgICAgICAgICAgLmZpcnN0KCk7XG5cbiAgICAgICAgaWYgKHBlZGlkbyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uubm90Rm91bmQoXCJOw6NvIGVuY29udHJhZG9cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHBlZGlkbyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGluYWN0aXZhdGUoeyByZXNwb25zZSAscGFyYW1zfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgICAgXG4gICAgICAgIGNvbnN0IGlkID0gcGFyYW1zLmlkO1xuXG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGRvYWNhbyA9IGF3YWl0IERvYWNhb1BldC5maW5kQnlPckZhaWwoXCJpZFwiLCBpZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvYWNhby5tZXJnZSh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXdhaXQgZG9hY2FvLnNhdmUoKTtcblxuXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2sodHJ1ZSk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KFwiU29tZXRoaW5nIGluIHRoZSByZXF1ZXN0IGlzIHdyb25nXCIpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgYWN0aXZhdGUoeyByZXNwb25zZSAscGFyYW1zfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgICAgXG4gICAgICAgIGNvbnN0IGlkID0gcGFyYW1zLmlkO1xuXG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGRvYWNhbyA9IGF3YWl0IERvYWNhb1BldC5maW5kQnlPckZhaWwoXCJpZFwiLCBpZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvYWNhby5tZXJnZSh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAxXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXdhaXQgZG9hY2FvLnNhdmUoKTtcblxuXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2sodHJ1ZSk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KFwiU29tZXRoaW5nIGluIHRoZSByZXF1ZXN0IGlzIHdyb25nXCIpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZGVsZXRlKHsgcmVzcG9uc2UgLHBhcmFtc306IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICAgIFxuICAgICAgICBjb25zdCBpZCA9IHBhcmFtcy5pZDtcblxuICAgICAgICB0cnkge1xuXG4gICAgICAgICAgICBjb25zdCBkb2FjYW8gPSBhd2FpdCBEb2FjYW9QZXQuZmluZEJ5T3JGYWlsKFwiaWRcIiwgaWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBkb2FjYW8ubWVyZ2Uoe1xuICAgICAgICAgICAgICAgIHN0YXR1czogM1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGF3YWl0IGRvYWNhby5zYXZlKCk7XG5cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHRydWUpO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdChcIlNvbWV0aGluZyBpbiB0aGUgcmVxdWVzdCBpcyB3cm9uZ1wiKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHVwZGF0ZVBob3RvKHsgcmVxdWVzdCwgcmVzcG9uc2UsIHBhcmFtc306IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoRWRpdENyZWF0ZVBob3RvQ2xpZW50ZVZhbGlkYXRvcik7XG4gICAgICAgLy8gY29uc3QgdXNlckF1dGggPSBhd2FpdCBhdXRoLnVzZShcImFwaVwiKS5hdXRoZW50aWNhdGUoKTtcblxuICAgICAgIFxuICAgICAgXG4gICAgICAgICAgICBjb25zdCBpZCA9IHBhcmFtcy5pZDsgICAgXG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vY29uc3QgY2xpZW50ZSA9IGF3YWl0IENsaWVudGUuZmluZEJ5T3JGYWlsKFwidXNlcl9pZFwiLCB1c2VyQXV0aC5pZCk7XG4gICAgICAgICAgICBjb25zdCBwZXQgPSBhd2FpdCBQZXQuZmluZEJ5T3JGYWlsKFwiaWRcIiwgaWQpO1xuXG4gICAgICAgICAgICBwZXQubWVyZ2Uoe1xuICAgICAgICAgICAgICAgIGZvdG86IHBheWxvYWQuZm90b1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGF3YWl0IHBldC5zYXZlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayh7XG4gICAgICAgICAgICBpZDpwZXQuaWQsXG4gICAgICAgICAgICBmb3RvOnBldC5mb3RvXG4gICAgICAgIH0pO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdChcIlNvbWV0aGluZyBpbiB0aGUgcmVxdWVzdCBpcyB3cm9uZ1wiKTtcbiAgICAgICAgfVxuXG4gICAgfVxufVxuIl19